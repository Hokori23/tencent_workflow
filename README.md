# tencent_workflow -- 肖千羽



## PS：运行请看`_client`、`__server`文件夹下的`README.md`

[视频演示](https://upyun.hokori.online/2020-10-28/tencent_workflow.mp4)

## 思路历程

拿到这个题目后，首先想的是先**确定前端技术栈**



<br/>

### 前端技术栈

第一个是确定了Vue，因为这是我的主要技术栈

第二个是确定了svg，因为我没有实际用svg或canvas作图的经验，所以稍微了解了一下，觉得svg是标签风格，可以更好地和Vue结合在一起

第三个是确定了Vue-Router，因为想用路由的参数来访问某个流程



<br/>

### 前端实现思路

先是想到了**节点**和**连线**之间的关系



- 在工作流静止状态时

> 节点可以有N条线（N>=0）
>
> 而连线一定要有两个节点依附着

所以我给节点设定了一个lines属性，连线设定了start和end属性标识起始点

这也给后面做**删除功能**提供了很大便利，

具体为：

1. 删除节点时同时删除该节点上所有线，以及线另一端节点对该线的引用
2. 删除线时同时删除两端节点对该线的引用



- 当工作流动态变化时，即线的一端被鼠标拖拽处于游离状态

> 我让线被拖拽的一端临时生成了一个不可见的节点（因为这个节点并不被渲染）
>
> 使得线被拖拽得以实现



------------------------



同时参考了[vue-workflow -- By 张凯](http://gitlab.centit.com/gitlab/zk/vue-workflow)的事件委托思想，把主要处理逻辑放在了`FlowPanel`中，

> 如：渲染节点数组、渲染连线数组的改变。

而更细致的处理，比如计算节点四个锚点的位置（`Node.vue`），计算动态连线的依附锚点（`Line.vue`）分别放在了各个组件中。

**以达成解耦的目的**



<br/>

### 后端实现思路

因为NodeJS个人比较熟练，采用的是`express`+`sequelize`的方案。

通过外键约束达成了

- 删除某流程时，该流程下的所有节点和连线都会被删除
- 删除某节点时，该节点下的连线都会被删除



并且在存储上将连线实体的start和end属性替换成了相应节点的id，即start_id、end_id

数据的处理由前端完成（为了节点和线相互建立引用）



数据库软件为MySQL，部署在阿里云服务器上，可直接连接



<br/>

### 个人理解的试题逻辑

由于是工作流，除了只能存在一个开始节点和结束节点的需求外。

个人添加了连线的终止点不能为开始节点、连线的起始点不能为结束节点的限制。



<br/>

### 缺陷

1. 连线没有画出箭头标志方向。
2. 仅在`新建节点`、`新建连线`、`流程切换`、`手动点击流程保存`时保存数据、体验较差。
3. 右侧编辑栏做了一个数据的浅克隆，且连线仅在保存后才更新相应可编辑的属性，体验较差。
4. 容错性比较低（BUG比较多），体验差。





<br/>

<br/>

## 参考项目

[vue-workflow -- By 张凯](http://gitlab.centit.com/gitlab/zk/vue-workflow)

![](https://upyun.hokori.online/2020-10-28/1603851937-305842-image.png)
